/*
This file is part of EDUC-tools.

    EDUC-tools is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    EDUC-tools is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with EDUC-tools.  If not, see <http://www.gnu.org/licenses/>.
*/

!function e(t,o,r){function n(a,s){if(!o[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=o[a]={exports:{}};t[a][0].call(l.exports,function(e){var o=t[a][1][e];return n(o?o:e)},l,l.exports,e,t,o,r)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,o){"use strict";angular.module("starter").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/home",templateUrl:"./templates/home.html",controller:"HomeCtrl"}).state("apropos",{url:"/apropos",templateUrl:"./templates/apropos.html",controller:"AproposCtrl"}).state("projet",{url:"/projet",templateUrl:"./templates/partie.html",controller:"PartieCtrl"}).state("partie",{url:"/partie",templateUrl:"./templates/chapitre.html",controller:"ChapitreCtrl"}).state("tp",{url:"/tp",abstract:!0,templateUrl:"./templates/menuTp.html",controller:"MenuTpCtrl"}).state("tp.page",{url:"/page/:id",views:{menuContent:{templateUrl:"./templates/tp.html",controller:"TpCtrl"}}}),t.otherwise("/home")}]).config(["$ionicConfigProvider","$logProvider","$compileProvider","$animateProvider",function(e,t,o,r){e.navBar.alignTitle("center"),t.debugEnabled(!0),o.debugInfoEnabled(!1),r.classNameFilter(/\banimated\b/),e.scrolling.jsScrolling(!1),e.views.maxCache(6),e.backButton.previousTitleText(!1),e.backButton.icon("ion-chevron-left"),e.backButton.text("")}])},{}],2:[function(e,t,o){"use strict";angular.module("starter").directive("myBackButton",["$ionicHistory",function(e){var t;return t="ion-chevron-left",{restrict:"E",template:function(e,o){return void 0==o.myShow&&(o.myShow="true"),void 0==o.myClick&&(o.myClick=""),'<ion-nav-buttons side="left"><button class="button button-icon '+t+'" ng-click="'+o.myClick+'" ng-show="'+o.myShow+'"></button></ion-nav-buttons>'}}}]).directive("myTp",function(){return{restrict:"E",scope:{data:"="},template:'<div ng-include="data.template"></div>'}}).directive("san",function(){return{restrict:"E",template:function(e,t){var o="";return void 0!=t.d&&(o=t.d),'<span ng-bind-html="'+o+'"></span>'}}})},{}],3:[function(e,t,o){"use strict";angular.module("starter").service("ArboFact",["$log",function(e){function t(e,t){return e=parseInt(e.split("_")[1]),t=parseInt(t.split("_")[1]),e-t}var o=this,r={};o.set=function(e){r=e},o.getProjets=function(){var e=[];for(var o in r)e.push(o);return e.sort(t)},o.getParties=function(e){var o=[];for(var n in r["projet_"+e])o.push(n);return o.sort(t)},o.getChapitres=function(e,o){var n=[];return n=r["projet_"+e]["partie_"+o],n.sort(t)}}]).service("ChoixFact",["Utils",function(e){var t=this,o=!0;t.doRefresh=function(e){return void 0===e?o:void(o=e)},t.projet=-1,t.partie=-1,t.chapitre=-1,t.init=function(){t.projet=-1,t.partie=-1,t.chapitre=-1},t.getProjet=function(){return t.projet},t.getPartie=function(){return t.partie},t.getChapitre=function(){return t.chapitre},t.setProjet=function(e){t.projet=e},t.setPartie=function(e){t.partie=e},t.setChapitre=function(e){t.chapitre=e},t.getPathProjet=function(){return e.getRoot()+"projet_"+t.projet.numero},t.getPathPartie=function(){return t.getPathProjet()+"/partie_"+t.partie.numero},t.getPathChapitre=function(){return t.getPathPartie()+"/chapitre_"+t.chapitre.numero}}]).service("Utils",["$http","$q","$cordovaNetwork",function(e,t,o){var r=this,n={};r.debugInfos=function(e){return void 0===e?n:void(n=e)},r.isInternet=function(){return o.isOnline()};var i="0.0.0";r.getVersion=function(){return i},r.setVersion=function(e,t,o){i=[e,t,o].join(".")};var a="00/00/00";r.getVerDate=function(){return a},r.setVerDate=function(e,t,o){a=[e,t,o].join("/")};var s="";r.getRoot=function(){return s},r.setRoot=function(e,t){c=t,s=e+t+"/"};var c="";r.getDirRoot=function(){return c},r.httpq=function(o){var r=t.defer();return e.get(o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},r.qAll=function(e){return t.all(e)},r.stopMedias=function(){var e,t=document.getElementsByTagName("video"),o=document.getElementsByTagName("audio");for(e=0;e<t.length;e++)t[e].pause();for(e=0;e<o.length;e++)o[e].pause()}}]).service("ScanRoot",["$ionicPlatform","$q","$log","Utils",function(e,t,o,r){function n(e){var t=/^(projet|partie|chapitre)_[0-9]{1,3}$/;return!!t.test(e)}function i(e,t){var o="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:o="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:o="Dossier introuvable";break;case FileError.SECURITY_ERR:o="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:o="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:o="INVALID_STATE_ERR";break;default:o="Erreur inconnue"}t({error:o})}function a(e,t){if(void 0==e.isDirectory||0==e.isDirectory)return t({error:"Le dossier "+r.getDirRoot()+" n'existe pas"}),!1;var o=e.createReader(),i=!0,a=-1,s=[],c={},u=function e(o){var r=arguments[1],u=arguments[2];o.readEntries(function(i){if(0==i.length)if(void 0===r){if(a=Object.keys(c).length,0==a)return t({error:"Aucun projet présent"}),!1;for(var l in c){var p=c[l].createReader();c[l]={},e(p,l)}}else if(void 0!==r&&void 0===u){if(a--,a>0)return!1;for(var f in c)s[f]=Object.keys(c[f]).length;var d=!0;for(var h in c)for(var m in c[h]){d=!1;var g=c[h][m].createReader();c[h][m]=[],e(g,h,m)}d===!0&&t(c)}else{s[r]--;var v=0;for(var b in s)v+=s[b];0==v&&t(c)}else{for(var P in i)if(1==i[P].isDirectory){var y=i[P].name;n(y)&&(void 0===r?c.hasOwnProperty(y)||(c[y]=i[P]):void 0!==r&&void 0===u?c[r].hasOwnProperty(y)||(c[r][y]=i[P]):void 0!==r&&void 0!==u&&(c[r][u].hasOwnProperty(y)||c[r][u].push(y)))}e(o,r,u)}},function(e){return i=!1,!1})};u(o),i===!1&&t({error:"Erreur lors de la lecture du dossier "+r.getDirRoot()})}var s=this;s.scan=function(t){e.ready(function(){if(s.initPath())window.resolveLocalFileSystemURL(r.getRoot(),function(e){a(e,t)},function(e){i(e,t)});else{var e={projet_1:{partie_0:["chapitre_1","chapitre_2","chapitre_3","chapitre_4"],partie_1:["chapitre_1","chapitre_2","chapitre_3","chapitre_4"],partie_2:[],partie_3:[],partie_4:["chapitre_1","chapitre_2","chapitre_3","chapitre_4","chapitre_5"],partie_5:["chapitre_1","chapitre_2","chapitre_3","chapitre_4"]},projet_2:{},projet_3:{}};t(e)}})},s.initPath=function(){return ionic.Platform.isWebView()?(ionic.Platform.isAndroid()?r.setRoot(cordova.file.externalRootDirectory,"EDUC-tools"):ionic.Platform.isWindowsPhone()?r.setRoot(cordova.file.externalRootDirectory,"EDUC-tools"):r.setRoot(cordova.file.externalRootDirectory,"EDUC-tools"),!0):(r.setRoot("","EDUC-tools"),!1)}}]).service("Courses",["ChoixFact","ArboFact","Utils",function(e,t,o){var r,n=this,i=[];n.get=function(e){return void 0!==e?r.then(function(t){return t.error.length>0?{error:t.error}:{course:t.courses[parseInt(e)]}}):r},n.init=function(){function n(e,t){return e=parseInt(e.numero),t=parseInt(t.numero),e-t}var a=e.getProjet().numero,s=t.getParties(a);if(s.indexOf("partie_0")===-1)return!1;var c=t.getChapitres(a,0);if(0==c.length)return!1;var u=[],l=[];for(var p in c){var f=o.getRoot()+"projet_"+a+"/partie_0/"+c[p]+"/config.json";u.push(o.httpq(f).then(function(e){i.push(e)}).catch(function(e){l.push("Fichier "+e.config.url+" introuvable")}))}var d=o.qAll(u).then(function(){i=i.sort(n);var e={courses:i,error:l};return e});return r=d,d}}])},{}],4:[function(e,t,o){"use strict";angular.module("starter",["ionic","ngTouch","ngAnimate","ngSanitize","ngCordova"]).run(["$ionicPlatform","ArboFact","Utils",function(e,t,o){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),o.setVersion(1,0,0),o.setVerDate(12,10,2016);var e=ionic.Platform.device(),t=ionic.Platform.isWebView(),r=ionic.Platform.isIPad(),n=ionic.Platform.isIOS(),i=ionic.Platform.isAndroid(),a=ionic.Platform.isWindowsPhone(),s=new Date;o.debugInfos({device:e,desktop:!t,ipad:r,ios:n,android:i,windows:a,date:s})})}])},{}],5:[function(e,t,o){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("starter").controller("ChapitreCtrl",["$scope","$log","$ionicModal","$state","$ionicListDelegate","$ionicHistory","$stateParams","ArboFact","Utils","ChoixFact",function(e,t,o,n,i,a,s,c,u,l){function p(){var t=l.getProjet().numero,o=l.getPartie().numero,n=c.getChapitres(t,o);if(0==n.length)return e.showChapitre=!1,!1;var i,a,s,p,f=function(){var t=function(e){return void 0==e.image||0==e.image.length?e.image="img/defaut-chapitre.png":e.image=l.getPathPartie()+"/chapitre_"+e.numero+"/"+e.image,e};i=function(e){return l.getPathPartie()+"/"+e+"/config.json"},a=[],s=[];for(p in n)a.push(u.httpq(i(n[p])).then(function(o){e.listeChapitres.push(t(o))}).catch(function(e){s.push("Fichier "+e.config.url+" introuvable")}));return{v:u.qAll(a).then(function(){return s})}}();return"object"===("undefined"==typeof f?"undefined":r(f))?f.v:void 0}function f(){e.modal.show()}return!!l.doRefresh()&&(e.$on("$ionicView.beforeEnter",function(){e.titre=l.getPartie().nom,e.showChapitre=!0,e.showError=!1,e.listeChapitres=[];var t=p();"boolean"!=typeof t&&t.then(function(t){t.length>0&&(e.showError=!0,e.initError=t)})}),e.selectChapitre=function(t,o){return"ION-ITEM"!=t.target.nodeName&&(e.modal.isShown()?(e.closeModal(),a.nextViewOptions({disableAnimate:!0})):i.closeOptionButtons(!1),l.setChapitre(e.listeChapitres[o]),l.doRefresh(!0),void(0==l.getPartie().numero?n.go("tp.page",{id:o}):n.go("tp.page")))},e.showDes=function(t,o){t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),i.closeOptionButtons(!1),e.dataModal=e.listeChapitres[o],e.dataModal.index=o,f()},e.modal={},o.fromTemplateUrl("templates/modals/chapitre.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.closeModal=function(){e.modal.hide()},void e.$on("$destroy",function(){e.modal.remove()}))}])},{}],6:[function(e,t,o){"use strict";angular.module("starter").controller("HomeCtrl",["$scope","$rootScope","$state","$ionicSlideBoxDelegate","$q","$log","$ionicHistory","$ionicModal","$ionicPopup","ArboFact","Utils","ChoixFact","ScanRoot",function(e,t,o,r,n,i,a,s,c,u,l,p,f){function d(){if(0==g.length)e.showProjet=!1;else{var t=[],o=[];for(var n in g)t.push(l.httpq(l.getRoot()+g[n]+"/config.json").then(function(t){e.projets.push(h(t))}).catch(function(e){var t=e.config.url.split("_")[1][0];o.push("Projet "+t+" invalide (fichier "+e.config.url+" introuvable)")}));l.qAll(t).then(function(){o.length>0&&(e.showInitError=!0,e.initError=o),e.showSpinner=!1,e.showProjet=!0,r.update()})}}function h(e){return 0==e.image.length?e.image="img/defaut-projet.png":e.image=l.getRoot()+"projet_"+e.numero+"/"+e.image,0==e.description.length&&(e.description="Aucune description"),l.httpq(l.getRoot()+"projet_"+e.numero+"/res/info.json").then(function(t){e.auteurs=[],e.sources=[],e.contacts=[];var o;for(o in t.author){var r=t.author[o];r.email.length>0&&(r.email=["(",r.email,")"].join("")),r.description.length>0&&(r.description=[": ",r.description].join("")),e.auteurs.push(r)}e.auteurs.team=e.auteurs.map(function(e){return e.nom}).join(" - "),0==e.auteurs.team.length&&(e.auteurs.team=" - ");for(o in t.source){var n=t.source[o];0==n.src.length?n.src="img/defaut-source.png":n.src=l.getRoot()+"projet_"+e.numero+"/res/"+n.src,0==n.description.length&&(n.description="Aucune description"),e.sources.push(n)}for(o in t.contact){var i=t.contact[o];i.partner="true"==i.partner,e.contacts.push(i)}}).catch(function(t){e.error="Informations indisponibles (fichier "+t.config.url+" introuvable)"}),e}function m(){e.modal.show()}e.titre="Projets EDUC-tools",e.showProjet=!1,e.showSpinner=!0,e.showError=!1,e.projets=[];var g=[];if(e.goApropos=function(){o.go("apropos")},!p.doRefresh())return!1;f.scan(function(t){e.dirRoot=l.getDirRoot(),void 0!=t.error?(u.set({}),e.$apply(function(){e.scanError=t.error,e.showError=!0})):(u.set(t),g=u.getProjets(),d())}),e.selectProjet=function(t,r){return"DoNotFire"==t.target.id?(t.preventDefault(),!1):(e.modal.isShown()&&e.closeModal(),p.setProjet(e.projets[r]),p.doRefresh(!0),void o.go("projet"))},e.modal={},e.showProjetModal=function(t,o){return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),void 0!=e.projets[o].error?(v(e.projets[o].error),!1):(e.dataModal=e.projets[o],e.dataModal.index=o,m(),!1)};var v=function(e){c.alert({title:"Aucune information",template:'Message d\'erreur :<br /><span class="assertive">'+e+"</span>"})};s.fromTemplateUrl("templates/modals/projet.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()})}])},{}],7:[function(e,t,o){"use strict";angular.module("starter").controller("MenuTpCtrl",["$scope","$state","$stateParams","$ionicHistory","Courses","ChoixFact","Utils",function(e,t,o,r,n,i,a){e.showMenuErreur=!1;var s=n.init();s===!1?e.showCours=!1:s.then(function(t){t.error.length>0?(e.showCours=!0,e.courses={},e.showMenuErreur=!0,e.menuErreur="Erreur lors du chargement"):(e.showCours=!0,e.courses=t.courses)}),e.selectCourse=function(e){i.doRefresh(!0),a.stopMedias(),t.go("tp.page",{id:e})},e.goApropos=function(){a.stopMedias(),t.go("apropos")},e.goChapitre=function(){i.doRefresh(!1),a.stopMedias();var e=r.viewHistory();for(var t in e.histories)"root"!=t&&delete e.histories[t];for(var o=0;o<e.histories.root.stack.length;o++)if("partie"==e.histories.root.stack[o].stateName){e.backView=e.histories.root.stack[o];break}e.forwardView=null,r.goBack(-1)},e.goHome=function(){r.nextViewOptions({disableBack:!0,disableAnimate:!0,historyRoot:!0}),i.doRefresh(!0),a.stopMedias(),t.go("home")},e.goBack=function(){i.doRefresh(!1),r.goBack()}}])},{}],8:[function(e,t,o){"use strict";angular.module("starter").controller("AproposCtrl",["$scope","$ionicHistory","$ionicModal","$cordovaEmailComposer","$ionicPopup","$cordovaClipboard","$timeout","ChoixFact","Utils",function(e,t,o,r,n,i,a,s,c){function u(){var e=c.debugInfos(),t=[];return t.push("########################################"),t.push("Debug report : "+e.date),t.push(""),t.push("Platform : "+e.device.platform),t.push("Version : "+e.device.version),t.push("Manufacturer : "+e.device.manufacturer),t.push("Model : "+e.device.model),t.push("Cordova : "+e.device.cordova),t.push("Virtual : "+e.device.isVirtual),t.push("Desktop : "+e.desktop),t.push("Version EDUC-tools : "+c.getVersion()),t.push(""),t.push("User report :"),t.push(""),t.join("\n")}function l(){var e=[];return e.push(""),e.push(""),e.push("End of report"),e.push("########################################"),e.join("\n")}e.version=c.getVersion(),e.date=c.getVerDate(),e.sendBug=function(t){if(t.length<16)return d(),!1;var o=[e.bug.begRapport,t,e.bug.endRapport];if(o=o.join("\n"),c.isInternet()){var n={to:"codedude.app@gmail.com",attachments:[],subject:"[EDUC-tools] Debug report",body:o,isHtml:!1};r.isAvailable().then(function(){r.open(n).then(function(){e.closeBug()},function(){e.closeBug()})},function(){f()})}else p()};var p=function(){n.alert({title:"Aucune connexion",template:"Vous n'êtes pas connecté à internet"})},f=function(){n.alert({title:"Echec de l'envoi",template:"Service indisponible"})},d=function(){n.alert({title:"Rapport incomplet",template:"L'explication du bug doit contenir au moins 16 caractères"})},h=function(t){var o=n.show({template:t,title:"Presse-papier",scope:e});a(function(){o.close()},1e3)};e.bug={titre:"Rapport de bug"},o.fromTemplateUrl("templates/modals/apropos.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openBug=function(){e.bug.begRapport=u(),e.bug.endRapport=l(),e.modal.show()},e.closeBug=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.copyToClipboard=function(t){if(t.length<16)return d(),!1;var o=[e.bug.begRapport,t,e.bug.endRapport];o=o.join("\n"),i.copy(o,function(){h("Copie réussie")},function(){h("Echec de la copie")})},e.goBack=function(){s.doRefresh(!1),t.goBack()}}])},{}],9:[function(e,t,o){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("starter").controller("PartieCtrl",["$scope","$ionicModal","$state","$ionicListDelegate","$ionicHistory","$log","$stateParams","ArboFact","Utils","ChoixFact",function(e,t,o,n,i,a,s,c,u,l){function p(){e.parties=[];var t=l.getProjet().numero,o=c.getParties(t);if(0==o.length)return e.showPartie=!1,!1;var n,i,a,s,p=function(){var t=function(e){return"general"==e.type?e.image="img/general-part.png":e.image=l.getPathProjet()+"/partie_"+e.numero+"/"+e.image,e};n=function(e){return l.getPathProjet()+"/"+e+"/config.json"},i=[],a=[];for(s in o)i.push(u.httpq(n(o[s])).then(function(o){e.parties.push(t(o))}).catch(function(e){a.push("Fichier "+e.config.url+" introuvable")}));return{v:u.qAll(i).then(function(){return a})}}();return"object"===("undefined"==typeof p?"undefined":r(p))?p.v:void 0}function f(){e.modal.show()}e.$on("$ionicView.beforeEnter",function(){if(!l.doRefresh())return!1;e.titre=l.getProjet().nom,e.showPartie=!0,e.showError=!1,e.parties=[];var t=p();"boolean"!=typeof t&&t.then(function(t){t.length>0&&(e.showError=!0,e.initError=t)})}),e.selectPartie=function(t,r){e.modal.isShown()?(e.closeModal(),i.nextViewOptions({disableAnimate:!0})):n.closeOptionButtons(!1),l.setPartie(e.parties[r]),l.doRefresh(!0),o.go("partie",{idPart:r})},e.showDes=function(t,o){t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),n.closeOptionButtons(!1),e.dataModal=e.parties[o],e.dataModal.index=o,f()},e.modal={},t.fromTemplateUrl("templates/modals/partie.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()})}])},{}],10:[function(e,t,o){"use strict";angular.module("starter").controller("TpCtrl",["$scope","$stateParams","$ionicScrollDelegate","$ionicModal","$ionicHistory","$cordovaFileOpener2","$ionicPopup","$cordovaInAppBrowser","$cordovaZip","$sce","ChoixFact","Utils","Courses",function(e,t,o,r,n,i,a,s,c,u,l,p,f){function d(){var t;t=e.idCours>0?l.getPathProjet()+"/partie_0/chapitre_"+e.idCours+"/tp.json":l.getPathChapitre()+"/tp.json",p.httpq(t).then(function(t){e.tps=h(t)}).catch(function(t){e.showError=!0,e.initError=["Fichier "+t.config.url+" introuvable"]})}function h(t){t=t.tp;for(var o in t){if(t[o].template="./templates/tp/"+t[o].type+".html","image"!=t[o].type&&"video"!=t[o].type&&"son"!=t[o].type&&"objet"!=t[o].type&&"html"!=t[o].type||(e.idCours>0?t[o].src=l.getPathProjet()+"/partie_0/chapitre_"+e.idCours+"/"+t[o].type+"/"+t[o].src:t[o].src=l.getPathChapitre()+"/"+t[o].type+"/"+t[o].src,0==t[o].source.length&&(t[o].source=" - ")),"image"==t[o].type&&(t[o].openImg=y),"objet"==t[o].type){t[o].openFile=g(t[o].src,t[o].mime);var r,n=t[o].mime.split("/")[1];switch(n){case"ifc":r="ifc";break;case"tbp":r="teklabim";break;case"pdf":r="pdf";break;case"xls":case"xlsx":r="excel";break;case"doc":case"docx":r="word";break;case"ppt":case"pptx":r="powerpoint";break;case"jpeg":case"jpg":case"png":case"gif":r="image";break;case"mp4":r="video";break;case"mp3":case"ogg":r="son";break;default:r="defaut"}t[o].image="img/logo_"+r+".png"}"lien"==t[o].type&&(t[o].openLink=v(t[o].lien)),"html"==t[o].type&&(t[o].openHtml=b(t[o].src.replace(".zip","")+"/index.html"),t[o].image="img/logo_html.png",ionic.Platform.isWebView()&&window.resolveLocalFileSystemURL(t[o].src.replace(".zip",""),null,function(){var e=t[o].src.split("/");delete e[e.length-1],e=e.join("/"),P(t[o].src,e)})),"texte"==t[o].type&&(t[o].texte=u.trustAsHtml(m(t[o].texte)))}return t}function m(e){var t=document.createElement("div");t.innerHTML=e,e=t.innerText;var o=new RegExp("<nl/>","g");e=e.replace(o,"<br />");for(var r in w)o=new RegExp("<"+r+">","g"),e=e.replace(o,'<span class="tp_'+w[r]+'">'),o=new RegExp("</"+r+">","g"),e=e.replace(o,"</span>");return e}function g(e,t){return function(){i.open(e,t).then(function(){p.stopMedias()},function(t){C(e,t)})}}function v(e){return function(t){return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),p.isInternet()?s.open(e,"_system",{}).then(function(e){p.stopMedias()}).catch(function(e){j("Service indisponible")}):j("Vous n'êtes pas connecté à internet"),!1}}function b(e){return function(t){return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),s.open(e,"_system",{}).then(function(e){p.stopMedias()}).catch(function(e){j("Service indisponible")}),!1}}function P(e,t){c.unzip(e,t).then(function(){window.resolveLocalFileSystemURL(e,function(e){e.remove(function(){},null)},null)},function(){j("Impossible de dézipper "+e)},function(e){})}function y(t){e.modal.data=t,e.modal.show()}e.idCours=0,e.tps={},e.chapitre={},e.showError=!1,e.$on("$ionicView.beforeEnter",function(){return o.scrollTop(!1),!!l.doRefresh()&&(t.id.length>0?(e.idCours=parseInt(t.id)+1,e.chapitre=f.get(t.id).then(function(t){void 0!=t.error?(e.showError=!0,e.initError=t.error):(e.chapitre=t.course,e.titre=e.chapitre.nom)})):(e.idCours=0,e.titre=l.getChapitre().nom),void d())}),e.to_trusted=function(e){return u.trustAsHtml(e)};var w={g:"bold",i:"italic",s:"underline",grand:"bigger",petit:"smaller",exp:"sup",ind:"sub",item:"item",uitem:"uitem",rouge:"red",vert:"green",bleu:"blue"},C=function(e,t){a.alert({title:"Ouverture impossible",template:"Erreur lors de l'ouverture du fichier "+e+'.<br />Message d\'erreur :<br /><span class="assertive">'+t.message+"</span>"})},j=function(e){a.alert({title:"Ouverture impossible",template:e})};e.modal={},r.fromTemplateUrl("templates/modals/img.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.closeImg=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()})}])},{}]},{},[4,2,5,6,7,8,9,10,1,3]);